# üí≥ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–æ–≤

## üß≠ –û–±—â–∏–π –æ–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ API Gateway. –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ ‚Äî —á–µ—Ä–µ–∑ Kafka (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ) –∏ gRPC (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ). –í–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å —Å–∏—Å—Ç–µ–º–æ–π —á–µ—Ä–µ–∑ REST-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å API Gateway.

---

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç         | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------------|----------|
| **API Gateway**  | REST-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã –≤ gRPC –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∏—Ö –Ω–∞ —Å–µ—Ä–≤–∏—Å—ã. –¢–∞–∫–∂–µ –æ—Ç–¥–∞–µ—Ç Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é. |
| **Orders Service** | –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ |
| **Payments Service** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–ø–∏—Å–∞–Ω–∏–µ –∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ |
| **Kafka**         | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –æ–±–º–µ–Ω —Å–æ–±—ã—Ç–∏—è–º–∏ |
| **PostgreSQL**    | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (—Å–≤–æ—è) |
| **Schema Registry** | –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ö–µ–º Kafka-—Å–æ–æ–±—â–µ–Ω–∏–π (Protobuf/Avro) |
| **Swagger UI**    | –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ REST API |

---

## üß∞ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- –Ø–∑—ã–∫: **Go**
- REST-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫: `gin`, `echo` –∏–ª–∏ `fiber`
- gRPC: `google.golang.org/grpc`
- Kafka: `segmentio/kafka-go` –∏–ª–∏ `confluent-kafka-go`
- –ë–î: PostgreSQL
- Swagger: `swaggo/swag`
- –°—Ö–µ–º—ã —Å–æ–æ–±—â–µ–Ω–∏–π: Protobuf –∏–ª–∏ Avro

---

## ‚öôÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### üìÑ Payments Service (—á–µ—Ä–µ–∑ API Gateway)
1. **–°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞**
   - –û–¥–∏–Ω —Å—á—ë—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å ‚Äî –æ—à–∏–±–∫–∞.
2. **–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞**
   - –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
3. **–ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞**
   - –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å —Å—á—ë—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### üìÑ Orders Service (—á–µ—Ä–µ–∑ API Gateway)
1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞**
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å: —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–∫–∞–∑, –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –æ–ø–ª–∞—Ç—ã.
2. **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
3. **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∑–∞–∫–∞–∑—É (–ø–æ ID).

---

## üìê –ü–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `POST /orders` –≤ API Gateway
2. Gateway –≤—ã–∑—ã–≤–∞–µ—Ç gRPC-–º–µ—Ç–æ–¥ `OrdersService.CreateOrder`
3. –°–µ—Ä–≤–∏—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `NEW` –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `OrderCreated` –≤ Outbox
4. Kafka Publisher —á–∏—Ç–∞–µ—Ç Outbox –∏ –ø—É–±–ª–∏–∫—É–µ—Ç –≤ Kafka
5. Payments Service —á–µ—Ä–µ–∑ Inbox —á–∏—Ç–∞–µ—Ç `OrderCreated`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å, —Å–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–Ω—å–≥–∏
6. –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Äî –ø—É–±–ª–∏–∫—É–µ—Ç `PaymentSucceeded`
7. Orders Service –ø–æ–ª—É—á–∞–µ—Ç —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑ –≤ –ë–î –Ω–∞ `FINISHED`

---

## üßæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### Orders Service

```sql
orders (
  id UUID PRIMARY KEY,
  user_id UUID,
  amount BIGINT,
  description TEXT,
  status TEXT CHECK (status IN ('NEW', 'FINISHED', 'CANCELED')),
  created_at TIMESTAMP
)
```

### Payments Service

```sql
accounts (
  id UUID PRIMARY KEY,
  user_id UUID UNIQUE,
  balance BIGINT,
  updated_at TIMESTAMP
)

transactions (
  id UUID PRIMARY KEY,
  account_id UUID,
  amount BIGINT,
  type TEXT CHECK (type IN ('DEBIT', 'CREDIT')),
  reference_order_id UUID,
  created_at TIMESTAMP
)
```

---

## üì® Kafka —Å–æ–±—ã—Ç–∏—è

### `OrderCreated`
```json
{
  "event_id": "uuid",
  "event_type": "OrderCreated",
  "occurred_at": "timestamp",
  "data": {
    "order_id": "uuid",
    "user_id": "uuid",
    "amount": 1000,
    "description": "—Ç–µ—Å—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞"
  }
}
```

### `PaymentSucceeded`
```json
{
  "event_id": "uuid",
  "event_type": "PaymentSucceeded",
  "occurred_at": "timestamp",
  "data": {
    "order_id": "uuid",
    "user_id": "uuid"
  }
}
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤

```
/api-gateway
  /docs             # Swagger
  /handlers         # REST endpoints
  /grpcclients      # gRPC stubs
  /main.go

/services/
  /orders
    /cmd
    /internal
      /grpc
      /kafka
      /db
      /outbox
  /payments
    /cmd
    /internal
      /grpc
      /kafka
      /db
      /inbox

/api/
  /proto/           # protobuf
  /schemas/         # Kafka schemas

```

---

## üß∞ Inbox / Outbox

- **Outbox**: —Å–æ–±—ã—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –∫–∞–∫ —á–∞—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∑–∞—Ç–µ–º –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ Kafka –æ—Ç–¥–µ–ª—å–Ω—ã–º –≤–æ—Ä–∫–µ—Ä–æ–º.
- **Inbox**: –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø–æ `event_id`.

---

## üìö Swagger

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `swaggo/swag`
- OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ `GET /swagger/doc.json`
- Swagger UI —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ API Gateway (`/docs`)

---

## ‚úÖ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- gRPC –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- REST –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–Ω–µ—à–Ω–µ–º —É—Ä–æ–≤–Ω–µ
- –í—Å—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (—Å–ø–∏—Å–∞–Ω–∏–µ, CAS, –±–∞–ª–∞–Ω—Å) ‚Äî —Å—Ç—Ä–æ–≥–æ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞
- Kafka —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ö–µ–º–∞–≤–∞–ª–∏–¥–∞—Ü–∏—é
- –ú–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–∫–∞ –Ω–µ—Ç
