# Интернет-магазин — Система управления заказами и оплатами

Этот проект реализует ключевые микросервисы для интернет-магазина: **Orders Service** и **Payments Service**, а также API Gateway для маршрутизации запросов.

## Описание задачи

В преддверии летних распродаж система должна обеспечить:

- Масштабируемость и высокую нагрузку
- Корректное управление заказами и оплатами
- Гарантии доставки и обработки сообщений с использованием семантики доставки

---

## Функциональность микросервисов

### Payments Service

- Создание счета (не более одного счета на пользователя)
- Пополнение счета
- Просмотр баланса

### Orders Service

- Создание заказа (с асинхронным запуском оплаты)
- Просмотр списка заказов пользователя
- Просмотр статуса отдельного заказа

---

## Архитектурное решение

- **API Gateway** отвечает только за маршрутизацию запросов к микросервисам.
- **Orders Service** реализует логику заказов.
- **Payments Service** отвечает за управление счетами и платежами.

Для обеспечения надежности и гарантий обработки сообщений применены:

- **Transactional Outbox** паттерн в Orders Service для безопасной передачи сообщений о создании заказа.
- **Transactional Inbox и Outbox** паттерны в Payments Service для обработки платежей с семантикой **exactly once** при списании денег.
- Использование **Kafka** для обмена сообщениями между сервисами.

---

## Важные отличия от требований

В отличие от требований, мы реализовали:

- В Orders Service: только **Transactional Outbox**
- В Payments Service: как **Transactional Inbox**, так и **Transactional Outbox**
- Хоть Api Gatway по прежнему принимает rest запросы, внутри сервисы все равно общаются по **grpc**

---

## Тестирование и документация

- Все API описаны и доступны через Swagger UI, покрывая все эндпоинты.
- Покрытие тестами превышает 17% кода (протестирована бизнес логика в ключевых сервисах).

---

## Контейнеризация и запуск

- Все сервисы упакованы в Docker-контейнеры.
- Запуск всей системы осуществляется одной командой через `docker-compose.yml`.
- Используются отдельные PostgreSQL базы данных для Payments и Orders.
- Kafka и Zookeeper настроены для обмена событиями.

---

## Ссылки на дизайн и документацию

- [Дизайн API Gateway](./api-gateway/design.md)
- [Дизайн Orders Service](./orders-service/design.md)
- [Дизайн Payments Service](./payments-service/design.md)
