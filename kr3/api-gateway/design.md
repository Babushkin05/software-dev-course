# API Gateway Design

## üìò –û–ø–∏—Å–∞–Ω–∏–µ

`api-gateway` ‚Äî —ç—Ç–æ —à–ª—é–∑, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ `orders-service` –∏ `payments-service` —á–µ—Ä–µ–∑ REST API. –û–Ω —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã –≤ gRPC-–≤—ã–∑–æ–≤—ã –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
api-gateway/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ orders/              # Protobuf-—Ñ–∞–π–ª—ã –¥–ª—è orders
‚îÇ   ‚îú‚îÄ‚îÄ payments/            # Protobuf-—Ñ–∞–π–ª—ã –¥–ª—è payments
‚îÇ   ‚îî‚îÄ‚îÄ gen/                 # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ gRPC –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ main.go              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ local.yaml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ deployments/             # Dockerfile, docker-compose –∏ –ø—Ä–æ—á–µ–µ
‚îÇ
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ client/              # gRPC –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ config/              # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ dto/                 # DTO —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ handler/             # REST-—Ö–µ–Ω–¥–ª–µ—Ä—ã –¥–ª—è Gin (orders, payments)
‚îÇ   ‚îî‚îÄ‚îÄ server/              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ Gin-—Å–µ—Ä–≤–µ—Ä–∞
‚îÇ
‚îú‚îÄ‚îÄ docs/                    # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ go.mod / go.sum
‚îî‚îÄ‚îÄ Makefile
```

---

## üö™ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### Orders

| –ú–µ—Ç–æ–¥ | URL                            | –û–ø–∏—Å–∞–Ω–∏–µ                  |
|-------|--------------------------------|---------------------------|
| POST  | `/api/v1/orders/`              | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞    |
| GET   | `/api/v1/orders?user_id=...`   | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤  |
| GET   | `/api/v1/orders/:id/status`    | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞  |

### Payments

| –ú–µ—Ç–æ–¥ | URL                              | –û–ø–∏—Å–∞–Ω–∏–µ                    |
|-------|----------------------------------|-----------------------------|
| POST  | `/api/v1/payments/account`       | –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ |
| POST  | `/api/v1/payments/deposit`       | –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞          |
| POST  | `/api/v1/payments/withdraw`      | –°–ø–∏—Å–∞–Ω–∏–µ —Å –±–∞–ª–∞–Ω—Å–∞          |
| GET   | `/api/v1/payments/balance`       | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞  |

---

## üß† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Go 1.24
- gRPC ‚Äî —Å–≤—è–∑—å –º–µ–∂–¥—É gateway –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏
- Gin ‚Äî HTTP —Å–µ—Ä–≤–µ—Ä –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- Swagger (swaggo) ‚Äî –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- Protobuf ‚Äî IDL –¥–ª—è gRPC
- Docker ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `config/local.yaml`:

```yaml
http:
  port: "8080"

services:
  orders:
    address: "localhost:50051"

grpc:
  paymentsAddr: "localhost:50052"
```

–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `config.MustLoad()`.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:  
  [http://localhost:8080/swagger/index.html](http://localhost:8080/swagger/index.html)


---

## ‚öôÔ∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å gRPC –∫–æ–¥
make proto

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Swagger
make swagger

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
go run cmd/main.go
```

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- Swagger —Ç—Ä–µ–±—É–µ—Ç DTO-—Å—Ç—Ä—É–∫—Ç—É—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ (orders/payments) –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ gRPC.
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ç—Ä–µ–π—Å–∏–Ω–≥ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ —É—Å–ª–æ–≤–∏—é.
