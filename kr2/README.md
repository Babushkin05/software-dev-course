# –ö–† 2 –ë–ê–ë–£–®–ö–ò–ù –í–û–í–ê

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–æ–≤

## grpc
–Ø —Ä–µ—à–∏–ª –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–ª—è —Å–µ–±—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é grpc, –ø–æ—ç—Ç–æ–º—É –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–ª –æ–±—â–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –º–µ–∂–¥—É —Å–æ–±–æ–π —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª

—Ç–∞–∫, –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ –µ—Å—Ç—å –ø–∞–ø–∫–∞ ***api*** –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–ø–∏—Å–∞–Ω—ã proto-—Ñ–∞–π–ª—ã - —Ñ–∞–π–ª—ã –æ–ø–∏—Å—ã–≤–∞—é—â–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤. –° –ø–æ–º–æ—â—å—é –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ dockerfile –∏–∑ —ç—Ç–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–º —É–∂–µ –ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ /internal/infrastructure/grpc)

## s3

–í —Ç–∞–±–ª–∏—Ü–µ –æ—Ç–≤–µ—Ç–æ–≤, —è —É–≤–∏–¥–µ–ª, —á—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤—ã —Ö–æ—Ç–µ–ª–∏ –¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –æ–±–ª–∞—á–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ s3. –Ø —Ä–µ—à–∏–ª –∏–∑—É—á–∏—Ç—å —ç—Ç—É —Ç–µ–º—É, –∏ –Ω–∞—à–µ–ª –∞–Ω–∞–ª–æ–≥ –æ—Ç –Ø–Ω–¥–µ–∫—Å–∞ - cloud object storage —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å s3 –æ—Ç amazon. –ü–æ—ç—Ç–æ–º—É —Ä–µ—à–∏–ª –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏–º. C –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ "minio" —è —Ö—Ä–∞–Ω—é —Ñ–∞–π–ª—ã –≤ –æ–±–ª–∞–∫–µ. –¢–∞–∫–∂–µ —è –≤—Å–µ-—Ç–∞–∫–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—é postgres –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

## –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞

–º–Ω–µ –ø–æ–∫–∞–∑–∞–ª–æ—Å—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º –±—ã —Å–¥–µ–ª–∞—Ç—å –Ω–µ –∞–Ω—Ç–∏–ø–ª–∞–≥–∏–∞—Ç, –∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞. –Ø –Ω–∞—à–µ–ª –±–∏–±–ª–∏–æ—Ç–µ–∫—É "vader", –∫–æ—Ç–æ—Ä–∞—è —ç—Ç–æ –¥–µ–ª–∞–µ—Ç

## –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ–±–ª–∞–¥–∞–µ—Ç –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–π —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π - 
```
analise-service
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ api
‚îÇ   ‚îú‚îÄ‚îÄ fileanalisys
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ file_analisys.proto
‚îÇ   ‚îú‚îÄ‚îÄ filestoring
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ file_storing.proto
‚îÇ   ‚îî‚îÄ‚îÄ gen
‚îÇ       ‚îú‚îÄ‚îÄ fileanalisys
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ file_analisys.pb.go
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ file_analisys_grpc.pb.go
‚îÇ       ‚îî‚îÄ‚îÄ filestoring
‚îÇ           ‚îú‚îÄ‚îÄ file_storing.pb.go
‚îÇ           ‚îî‚îÄ‚îÄ file_storing_grpc.pb.go
‚îú‚îÄ‚îÄ cmd
‚îÇ   ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ config
‚îÇ   ‚îî‚îÄ‚îÄ local.yaml
‚îú‚îÄ‚îÄ deployments
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ go.sum
‚îî‚îÄ‚îÄ internal
    ‚îú‚îÄ‚îÄ application
    ‚îÇ   ‚îú‚îÄ‚îÄ ports
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analisys_usecase.go
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ output
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ sentiment_analyzer.go
    ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ storing_client.go
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ wordcloud_generator.go
    ‚îÇ   ‚îî‚îÄ‚îÄ services
    ‚îÇ       ‚îî‚îÄ‚îÄ analisys_service.go
    ‚îú‚îÄ‚îÄ config
    ‚îÇ   ‚îî‚îÄ‚îÄ config.go
    ‚îú‚îÄ‚îÄ domain
    ‚îÇ   ‚îî‚îÄ‚îÄ entities
    ‚îÇ       ‚îî‚îÄ‚îÄ analisys_result.go
    ‚îî‚îÄ‚îÄ infrastructure
        ‚îú‚îÄ‚îÄ analisys
        ‚îÇ   ‚îú‚îÄ‚îÄ vader_adapter.go
        ‚îÇ   ‚îî‚îÄ‚îÄ wordcloud_adapter.go
        ‚îî‚îÄ‚îÄ grpc
            ‚îú‚îÄ‚îÄ server.go
            ‚îî‚îÄ‚îÄ storing_client.go
```

## –∑–∞–ø—É—Å–∫

```
–æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –±–µ–∑ .env –≤ –∫–æ—Ç–æ—Ä–æ–º —É–∫–∞–∑–∞–Ω—ã –∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ s3 –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è storage-service –∏ –∑–∞ –Ω–∏–º —É–ø–∞–¥–µ—Ç –≤—Å–µ
```

```
docker-compose build
docker-compose up
```

–≤ ***docker-compose.yaml*** —è –≤—ã–∑—ã–≤–∞—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –º–æ–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.

## –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

–ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤ –ª–æ–≥–∞—Ö —Å—Ä–∞–∑—É –≤–∏–¥–∏–º –∫—Ä–∞—Ç–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ api –¥–ª—è api-gateway:

```
api-gateway      |  - using env:        export GIN_MODE=release
api-gateway      |  - using code:       gin.SetMode(gin.ReleaseMode)
api-gateway      | 
api-gateway      | [GIN-debug] POST   /upload                   --> github.com/Babushkin05/software-dev-course/kr2/api-gateway/internal/presentation/service_http/handlers.(*FileHandler).Upload-fm (3 handlers)
api-gateway      | [GIN-debug] POST   /analyze/:file_id         --> github.com/Babushkin05/software-dev-course/kr2/api-gateway/internal/presentation/service_http/handlers.(*FileHandler).Analyze-fm (3 handlers)
api-gateway      | [GIN-debug] GET    /download/:file_id        --> github.com/Babushkin05/software-dev-course/kr2/api-gateway/internal/presentation/service_http/handlers.(*FileHandler).Download-fm (3 handlers)
api-gateway      | [GIN-debug] GET    /wordcloud/:file_id       --> github.com/Babushkin05/software-dev-course/kr2/api-gateway/internal/presentation/service_http/handlers.(*FileHandler).WordCloud-fm (3 handlers)
```

## –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞, –∏—Å–ø–æ–ª—å–∑—É—é –¥–æ —Å–ª–µ–∑ —Ç–µ–∫—Å—Ç –æ —Ç–æ–º –∫–∞–∫ –°.–ê. –í–∏–¥–µ–Ω–∏–Ω –Ω–µ –≤–µ—Ä–Ω—É–ª –∫–Ω–∏–∂–∫—É –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É:

```
To be honest, it's much worse there üôà I've been living with this burden for 17 years... Maybe if I tell you, it will make me feel better?

Actually, a professor, my academic supervisor, took this book from the university library for me. The book was only for work in the reading room... He took it for me on his own responsibility (I was writing a dissertation and I needed to touch on the history of computer science).

I promise to go to Krasnoyarsk this summer and return it.
```

### –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –≤ –æ–±–ª–∞–∫–æ

```
curl -X POST http://localhost:8080/upload -F "file=@testfile.txt"
```

–ø–æ–ª—É—á–∞—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
{"file_id":"301c453b-9ac5-4bdf-ab78-159916a69001"}
```
—ç—Ç–æ uuid –∫–æ—Ç–æ—Ä—ã–π –º–Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç –≥—É–≥–ª–∞, —Å —Ç–∞–∫–∏–º –∞–π–¥–∏ —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–µ–∫—Å—Ç –≤ yandex cloud object storage

![alt text](./test/assets/cloud_ui.png)

–∫–∞–∫ –≤–∏–¥–∏–º –≤ ui - –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è

### –≤—ã–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª

```
curl -X GET http://localhost:8080/download/301c453b-9ac5-4bdf-ab78-159916a69001 -o downloaded.txt
```

–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ, [—Å–∫–∞—á–∞–ª–æ—Å—å](./test/downloaded.txt)

### –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞

```
curl -X POST http://localhost:8080/analyze/301c453b-9ac5-4bdf-ab78-159916a69001
```

–ø–æ–ª—É—á–∞–µ–º –≤ –∫–æ–Ω—Å–æ–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```
Positive: 5.86%, Negative: 6.28%, Neutral: 87.87%, Compound: -0.1027%  
```

### –æ–±–ª–∞–∫–æ —Å–ª–æ–≤

```
curl -X GET http://localhost:8080/wordcloud/301c453b-9ac5-4bdf-ab78-159916a69001 -o cloud.png
```
–≤–∞–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å png, –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Ç–∞–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞

—Ä–µ–∑—É–ª—å—Ç–∞—Ç

![—Ç–µ–∫—Å—Ç](./test/cloud.png)

–∫–æ–Ω–µ—á–Ω–æ, —ç—Ç–æ –∞–ø–∏ —Ä–∏—Å—É–µ—Ç –Ω–µ –ª—É—á—à–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–æ –∑–∞—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π


## –∏—Ç–æ–≥

–í–æ–æ–±—â–µ, –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Ö–æ—Ç–µ–ª –µ—â–µ –∏ —Å–¥–µ–ª–∞—Ç—å in-momory –±–¥ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—ç—à–∞ –≤ analisys-service, –Ω–æ –∫–∞–∫-—Ç–æ –∏ —Ç–∞–∫ —Ç—Ä—É–¥–æ–∑–∞–≤—Ç—Ä–∞—Ç–Ω–æ –≤—ã—à–ª–æ)

–ï—â–µ –ø—Ä–∏–∫–æ–ª - –∏–∑-–∑–∞ —Ç–æ–≥–æ —á—Ç–æ —è –≤ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –ø—É—Ç–∞—é—Å—å, —è –ø–∏—Å–∞–ª —Ç–æ analisys-service —Ç–æ analise-service —Ç–æ analysis-service –∏ –∏–∑-–∑–∞ —ç—Ç–æ–≥–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª 2 —á–∞—Å–∞ –Ω–∞ –¥–µ–±–∞–≥, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –≤–∏–¥–µ–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞)) (–∏—Å–∫–∞–ª–∏ –ø–æ–¥ —á—É–∂–∏–º–∏ –∏–º–µ–Ω–∞–º–∏)

—Ç–µ—Å—Ç—ã –Ω–µ –ø–∏—Å–∞–ª.